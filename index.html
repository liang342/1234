<!DOCTYPE html>
<html>
<head>
    <title>新手蚂蚁指南</title>
    <style>
        /* 新增管理员专属样式 */
        .admin-only { display: none; }
        .admin-mode .admin-only { display: block; }
        .article-controls { margin-top: 10px; }
        #articleForm { border: 1px solid #eee; padding: 15px; }
    </style>
</head>
<body>
    <!-- 新增文章发布表单 -->
    <div id="articleForm" class="admin-only">
        <h3>发布新指南</h3>
        <input type="text" id="articleTitle" placeholder="文章标题">
        <textarea id="articleContent" placeholder="内容（支持HTML）" rows="5"></textarea>
        <button onclick="publishArticle()">发布</button>
    </div>

    <!-- 修改后的文章列表 -->
    <div id="main" style="display:none;">
        <h2>知识库 
            <button class="admin-only" onclick="toggleEditor()">📝 写指南</button>
        </h2>
        <ul id="articles"></ul>
    </div>

    <script>
        // 初始化文章数据存储
        let articles = JSON.parse(localStorage.getItem('articles')) || [
            { 
                id: 1, 
                title: "入门指南", 
                content: "<h4>新人必读</h4><p>1. 每日签到...</p>",
                author: "系统管理员",
                timestamp: "2024-03-20"
            }
        ];

        // 增强登录功能
        function login() {
            const userId = document.getElementById("userList").value;
            if (userId && users[userId]) {
                const user = users[userId];
                localStorage.setItem("currentUser", JSON.stringify(user));
                
                // 管理员模式激活
                if(user.role === 'admin') {
                    document.body.classList.add('admin-mode');
                }
                
                loadArticles();
            }
        }

        // 动态加载文章
        function loadArticles() {
            const container = document.getElementById('articles');
            container.innerHTML = articles.map(article => `
                <li data-id="${article.id}">
                    <h4>${article.title}</h4>
                    <div class="article-content">${article.content}</div>
                    <div class="article-meta">
                        <span>作者：${article.author}</span>
                        <span>${article.timestamp}</span>
                        <div class="article-controls admin-only">
                            <button onclick="editArticle(${article.id})">✏️编辑</button>
                            <button onclick="deleteArticle(${article.id})">🗑️删除</button>
                        </div>
                    </div>
                </li>
            `).join('');
        }

        // 管理员发布功能
        function publishArticle() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if(user?.role !== 'admin') return;
            
            const newArticle = {
                id: Date.now(),
                title: document.getElementById('articleTitle').value,
                content: document.getElementById('articleContent').value,
                author: user.name,
                timestamp: new Date().toLocaleDateString()
            };
            
            articles.push(newArticle);
            localStorage.setItem('articles', JSON.stringify(articles));
            loadArticles();
            toggleEditor();
        }

        // 文章编辑功能
        function editArticle(id) {
            const article = articles.find(a => a.id === id);
            document.getElementById('articleTitle').value = article.title;
            document.getElementById('articleContent').value = article.content;
            toggleEditor(true);
        }

        // 删除功能
        function deleteArticle(id) {
            if(confirm('确定删除这篇指南？')) {
                articles = articles.filter(a => a.id !== id);
                localStorage.setItem('articles', JSON.stringify(articles));
                loadArticles();
            }
        }

        // 切换编辑器显示
        function toggleEditor(show = false) {
            const form = document.getElementById('articleForm');
            form.style.display = show ? 'block' : 
                (form.style.display === 'block' ? 'none' : 'block');
        }
    </script>
</body>
</html>
